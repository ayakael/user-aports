Patch-Source: https://github.com/artemsen/swayimg/pull/20
--
From cc77bbc63eac78c743bff33956f8d3b20aed931d Mon Sep 17 00:00:00 2001
From: Jakub Jirutka <jakub@jirutka.cz>
Date: Sun, 13 Feb 2022 22:01:48 +0100
Subject: [PATCH] Add support for system-level config (XDG_CONFIG_DIRS)

---
 README.md         |  2 ++
 extra/swayimgrc   |  2 ++
 extra/swayimgrc.5 |  2 ++
 src/config.c      | 19 ++++++++++++++++++-
 4 files changed, 24 insertions(+), 1 deletion(-)

diff --git a/README.md b/README.md
index 0af0b8b..4f5f3cc 100644
--- a/README.md
+++ b/README.md
@@ -60,6 +60,8 @@ The viewer searches for the configuration file with name `config` in the
 following directories:
 - `$XDG_CONFIG_HOME/swayimg`
 - `$HOME/.config/swayimg`
+- `$XDG_CONFIG_DIRS/swayimg`
+- `/etc/xdg/swayimg`
 
 Sample file is available [here](https://github.com/artemsen/swayimg/blob/master/extra/swayimgrc).
 
diff --git a/extra/swayimgrc b/extra/swayimgrc
index f5e8a82..9f3e206 100644
--- a/extra/swayimgrc
+++ b/extra/swayimgrc
@@ -4,6 +4,8 @@
 # The viewer searches for the config file in the following locations:
 # 1. $XDG_CONFIG_HOME/swayimg/config
 # 2. $HOME/.config/swayimg/config
+# 3. $XDG_CONFIG_DIRS/swayimg/config
+# 4. /etc/xdg/swayimg/config
 # See `man swayimgrc` for details.
 
 # Initial scale (default, fit, or real)
diff --git a/extra/swayimgrc.5 b/extra/swayimgrc.5
index eefccad..2d498d1 100644
--- a/extra/swayimgrc.5
+++ b/extra/swayimgrc.5
@@ -7,6 +7,8 @@ swayimgrc \- Swayimg configuration file
 .SH SYNOPSIS
 .SY \fI$XDG_CONFIG_HOME\fR/swayimg/config
 .SY \fI$HOME\fR/.config/swayimg/config
+.SY \fI$XDG_CONFIG_DIRS\fR/swayimg/config
+.SY \fR/etc/xdg/swayimg/config
 .\" format description
 .SH DESCRIPTION
 .SS General format description
diff --git a/src/config.c b/src/config.c
index 5f53d7c..ce1e752 100644
--- a/src/config.c
+++ b/src/config.c
@@ -60,8 +60,8 @@ static FILE* open_file(void)
     size_t len;
     const char* postfix = "/swayimg/config";
     const size_t postfix_len = strlen(postfix);
+    char* config_dir = getenv("XDG_CONFIG_HOME");
 
-    const char* config_dir = getenv("XDG_CONFIG_HOME");
     if (config_dir) {
         len = strlen(config_dir);
         if (len < sizeof(path)) {
@@ -86,6 +86,23 @@ static FILE* open_file(void)
     }
 
     if (len && len + postfix_len < sizeof(path)) {
+        memcpy(path + len, postfix, postfix_len + 1 /*last null*/);
+        FILE *fd = fopen(path, "r");
+        if (fd != NULL) {
+            return fd;
+        }
+    }
+
+    if ((config_dir = getenv("XDG_CONFIG_DIRS"))) {
+        // we use only the first directory to keep it simple
+        const char* colon = strchr(config_dir, ':');
+        len = colon ? (size_t)(colon - config_dir) : strlen(config_dir);
+    } else {
+        config_dir = "/etc/xdg";
+        len = strlen(config_dir);
+    }
+    if (len && len + postfix_len < sizeof(path)) {
+        memcpy(path, config_dir, len);
         memcpy(path + len, postfix, postfix_len + 1 /*last null*/);
         return fopen(path, "r");
     }
