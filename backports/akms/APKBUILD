# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=akms
pkgver=0_git20210805
_gitrev=64fad85b9911f3dd03f9b72ab5cfd338b9735931
pkgrel=0
pkgdesc="Alpine Kernel Module Support"
url="https://github.com/jirutka/akms"
arch="noarch"
license="MIT"
depends="bubblewrap cmd:depmod kernel-hooks"
makedepends="asciidoctor"
triggers="$pkgname.trigger=/usr/src/*"
install="$pkgname.pre-install $pkgname.post-install $pkgname.pre-deinstall"
subpackages="$pkgname-doc"
source="https://github.com/jirutka/akms/archive/$_gitrev/$pkgname-$_gitrev.tar.gz
	akms.hook
	modules-load.conf
	"
builddir="$srcdir/$pkgname-$_gitrev"
options="!check"  # no tests provided

build() {
	make build
}

package() {
	make install DESTDIR="$pkgdir" prefix=/usr
	install -D -m755 "$srcdir"/akms.hook "$pkgdir"/usr/share/kernel-hooks.d/akms.hook

	# See https://github.com/jirutka/akms/issues/5
	install -Dm644 "$srcdir"/modules-load.conf "$pkgdir"/usr/lib/modules-load.d/$pkgname.conf
}

sha512sums="
69f310ab61d465704278669342bfc01d284a6446d6d0e8c74dd0ad04f3fdc6e43200a7e778b2555d401490eb6f74598648f090b313013388f4d5ec70455d9042  akms-64fad85b9911f3dd03f9b72ab5cfd338b9735931.tar.gz
5b80295491b7804b30700e66385e243d568542fc7679eb38389ff3b9ca60f0b67a42c89ec47210d7f58ad0f39bd016edcab7016c9a8609a861d17f42dfa4063b  akms.hook
e61ebacae17e4e6b9ec39c0673d46c7764cba7f1378208341688f201c396a1599f8a518ce0849f36da0de2710391014f45d90ab09f6b36a579970d1672b0d71d  modules-load.conf
"
