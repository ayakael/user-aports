# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=akms
pkgver=0_git20210804
_gitrev=c33427311c904273c4d0d6405fc8ec0cf2c9c212
pkgrel=0
pkgdesc="Alpine Kernel Module Support"
url="https://github.com/jirutka/akms"
arch="noarch"
license="MIT"
depends="bubblewrap cmd:depmod kernel-hooks"
makedepends="asciidoctor"
triggers="$pkgname.trigger=/usr/src/*"
install="$pkgname.pre-install $pkgname.post-install $pkgname.pre-deinstall"
subpackages="$pkgname-doc"
source="https://github.com/jirutka/akms/archive/$_gitrev/$pkgname-$_gitrev.tar.gz
	akms.hook
	"
builddir="$srcdir/$pkgname-$_gitrev"
options="!check"  # no tests provided

build() {
	make build
}

package() {
	make install DESTDIR="$pkgdir" prefix=/usr
	install -D -m755 "$srcdir"/akms.hook "$pkgdir"/usr/share/kernel-hooks.d/akms.hook
}

sha512sums="
e77e58869fe189d44292183f10fbe4339caa242bc2f0fc5ccee35efc1a479433b7eee40b6b89b852b21e0c072f84ec688431a55b28cd3539a379a81f1bd96b17  akms-c33427311c904273c4d0d6405fc8ec0cf2c9c212.tar.gz
5b80295491b7804b30700e66385e243d568542fc7679eb38389ff3b9ca60f0b67a42c89ec47210d7f58ad0f39bd016edcab7016c9a8609a861d17f42dfa4063b  akms.hook
"
