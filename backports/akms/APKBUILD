# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=akms
pkgver=0_git20210808
_gitrev=c4c0966fda45dbc173f9356fd27c656a1c17b784
pkgrel=0
pkgdesc="Alpine Kernel Module Support"
url="https://github.com/jirutka/akms"
arch="noarch"
license="MIT"
depends="bubblewrap cmd:depmod kernel-hooks"
makedepends="asciidoctor"
triggers="$pkgname.trigger=/usr/src/*"
install="$pkgname.pre-install $pkgname.post-install $pkgname.pre-deinstall"
subpackages="$pkgname-doc"
source="https://github.com/jirutka/akms/archive/$_gitrev/$pkgname-$_gitrev.tar.gz
	modules-load.conf
	"
builddir="$srcdir/$pkgname-$_gitrev"
options="!check"  # no tests provided

build() {
	make build
}

package() {
	make install DESTDIR="$pkgdir" prefix=/usr

	# See https://github.com/jirutka/akms/issues/5
	install -Dm644 "$srcdir"/modules-load.conf "$pkgdir"/usr/lib/modules-load.d/$pkgname.conf
}

sha512sums="
fd93a47689db447650ffef1bc414059f429b4b0ed6268e6eaa6150b4e2aa89eb075bee473ff39dda9c84abafd164b3b8f143b32f94e82c593d0f28f2ff582346  akms-c4c0966fda45dbc173f9356fd27c656a1c17b784.tar.gz
e61ebacae17e4e6b9ec39c0673d46c7764cba7f1378208341688f201c396a1599f8a518ce0849f36da0de2710391014f45d90ab09f6b36a579970d1672b0d71d  modules-load.conf
"
