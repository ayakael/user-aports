# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=acpid
pkgver=2.0.32
pkgrel=1
pkgdesc="The ACPI Daemon (acpid) With Netlink Support"
url="https://sourceforge.net/projects/acpid2/"
arch="all"
license="GPL-2.0-or-later"
makedepends="linux-headers"
subpackages="$pkgname-doc $pkgname-openrc"
source="https://downloads.sourceforge.net/sourceforge/acpid2/acpid-$pkgver.tar.xz
	handler.sh
	power-supply-ac
	lid-closed
	anything
	acpid2.initd
	acpid2.confd
	"
builddir="$srcdir/acpid-$pkgver"
options="!check"  # no tests provided

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}

package() {
	make install DESTDIR="$pkgdir"

	cd "$pkgdir"

	install -D -m 755 "$srcdir"/handler.sh etc/acpi/handler.sh
	install -D -m 644 "$srcdir"/anything etc/acpi/events/anything
	install -D -m 755 "$srcdir"/power-supply-ac "$srcdir"/lid-closed -t usr/share/acpid/

	# Service name acpid is taken by busybox acpid (busybox-initscripts).
	install -D -m 755 "$srcdir"/acpid2.initd etc/init.d/acpid2
	install -D -m 644 "$srcdir"/acpid2.confd etc/conf.d/acpid2
}

sha512sums="
c7afffdf9818504e1ac03b0ad693a05f772bfd07af9808262b3b6bb82ca4dabe6253c94e6dc59e5be6f0da9e815e8bcf2d3e16f02b23d0248b6bad4509e78be7  acpid-2.0.32.tar.xz
2c029c5dd3ed4593317328da13ffcd547a80d7dc9690886c7fcf7ee8324884d9a94e333d4ba9c4b886dc05146d1ad220452f1cfc76d8e3eb6ce48ca568709595  handler.sh
daf2510f202377a4db9b52448e4805bc4468c66f507cd4e676dc589306b716043c653ff18b697a4c37e5a005123a64a0278f3e4980504d98dd42ac9e95a3443f  power-supply-ac
f6df3e75198e779826c187038804ba80e7a445567342ac912ff4e5d894ce936fb9347146c302c7d7c9bbc8b3a0e47aeee9d23a4b297ee37e3938b7310a1b5ad9  lid-closed
2e04e5c8a428bfc653b4d56f5a2ff4472169a094ed9eee4b02ea88c755848e4803a0edeb054e152516ee50cb67c8c2be2c43e2e9db9dc80b7fcf218b8907ef6c  anything
b146370f9c9b3917a7d8c840bc7a5bbb022e6b86cfeaeeac762c0369bc15801e1ab63584f272fedc31f915e6ba12e34c9f9b2d1a31e7e08e83d5075a023d42e2  acpid2.initd
0e8d39b4aa00d8bfa0b9a490c52e0e96bf4a34d27347f07a8289d57be73b369e93bdca29529beda52cb102ad0a4f3149549916fe6924ee7531974fa5b92716b7  acpid2.confd
"
