# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=apk-deploy
pkgver=0.2.0
pkgrel=0
pkgdesc="Script for deploying applications in APK packages via SSH"
url="https://github.com/jirutka/user-aports"
arch="noarch"
license="MIT"
depends="apk-tools openssh-keygen sudo"
pkgusers="deploy"
pkggroups="$pkgusers"
install="$pkgname.pre-install"
source="apk-deploy-addkey
	apk-deploy-pkg
	apk-deploy.sudoersd
	"
options="!check"

package() {
	mkdir -p "$pkgdir"
	cd "$pkgdir"

	install -D -m 755 "$srcdir"/apk-deploy-pkg ./usr/bin/apk-deploy-pkg
	install -D -m 755 "$srcdir"/apk-deploy-addkey ./usr/sbin/apk-deploy-addkey
	install -D -m 640 "$srcdir"/apk-deploy.sudoersd ./etc/sudoers.d/$pkgname

	install -d -m 755 -o $pkgusers -g "$pkggroups" \
		./home/deploy \
		./home/deploy/packages
	install -d -m 700 -o $pkgusers -g "$pkggroups" \
		./home/deploy/.ssh
}

sha512sums="002a67d117cbe4a10434d6196f4c8b52db4c5056c4ec9ca20a257437d4038f8d7b29b6985422decfec2d5fef98c73f3079e0f39ee4d779cb2a568b050f0b83dc  apk-deploy-addkey
06462f6b6ab93d0031c86443b70b6607c28064dc1a55c78b46c4d85573e5d3f7aa6487e5766a8ec11b48ade2e6b6022de2b2b536144a1e5e5ce2b23a7cee9b79  apk-deploy-pkg
a945ba0d23efcfe04f997b8a98d837f626f8b0ebdedb3ebb9f8cbfd4408fb9e848c8648e3db7cb30215b43ec8a516049de162ee717eaf09ada14979bfc2e1856  apk-deploy.sudoersd"
