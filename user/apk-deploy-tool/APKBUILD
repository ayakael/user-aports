# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=apk-deploy-tool
pkgver=0.4.0
pkgrel=0
pkgdesc="Script for deploying applications in APK packages via SSH"
url="https://github.com/jirutka/user-aports"
arch="noarch"
license="MIT"
depends="apk-tools openssh-keygen sudo"
pkgusers="deploy"
pkggroups="$pkgusers"
provides="apk-deploy=$pkgver-r$pkgrel"  # for backward compatibility
replaces="apk-deploy"  # for backward compatibility
install="$pkgname.pre-install"
source="https://github.com/jirutka/apk-deploy-tool/archive/v$pkgver/$pkgname-$pkgver.tar.gz
	$pkgname.sudoersd
	"
builddir="$srcdir/$pkgname-$pkgver"
options="!check"

package() {
	make install DESTDIR="$pkgdir" prefix=/usr

	cd "$pkgdir"

	install -D -m 640 "$srcdir"/$pkgname.sudoersd ./etc/sudoers.d/$pkgname

	install -d -m 755 -o $pkgusers -g "$pkggroups" \
		./home/deploy \
		./home/deploy/packages
	install -d -m 700 -o $pkgusers -g "$pkggroups" \
		./home/deploy/.ssh
}

sha512sums="d1ab94df180ddb631f9673b85e7e48cdc3beb3f5c3534f07a73d6fe127734bd3338b3f77fadb52b606a467a69911f43d4ae35a99bd16789be8baa2933d1ac6a7  apk-deploy-tool-0.4.0.tar.gz
a945ba0d23efcfe04f997b8a98d837f626f8b0ebdedb3ebb9f8cbfd4408fb9e848c8648e3db7cb30215b43ec8a516049de162ee717eaf09ada14979bfc2e1856  apk-deploy-tool.sudoersd"
